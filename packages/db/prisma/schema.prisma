// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ‘¤ UTILISATEURS & AUTHENTIFICATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model User {
  id            Int       @id @default(autoincrement())
  email         String    @unique
  name          String
  password      String    // HashÃ© avec bcrypt
  level         Int       @default(1)
  xp            Int       @default(0)  // Glands collectÃ©s
  hedgehogState String    @default("baby") // baby, child, teen, adult, elder
  profilePublic Boolean   @default(false) // US16: profils publics opt-in
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  habits          Habit[]
  habitLogs       HabitLog[]
  userProgress    UserProgress?
  focusSessions   FocusSession[]
  userBadges      UserBadge[]
  userDecorations UserDecoration[]

  @@index([level, xp]) // Pour les classements (US15)
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“ HABITUDES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model Habit {
  id            Int        @id @default(autoincrement())
  userId        Int
  name          String     @db.VarChar(50)
  emoji         String     @default("âœ…")
  type          HabitType  @default(GOOD) // GOOD or BAD
  frequency     Frequency  @default(DAILY) // DAILY or WEEKLY
  isActive      Boolean    @default(true) // Soft delete
  decorationId  Int?       // US12: Lien avec Ã©lÃ©ment de dÃ©cor
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  // Relations  
  user          User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  habitLogs     HabitLog[]
  focusSessions FocusSession[]
  decoration    DecorationItem?  @relation(fields: [decorationId], references: [id])

  @@index([userId, isActive])
  @@index([userId, createdAt])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š LOGS & COMPLÃ‰TION DES HABITUDES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model HabitLog {
  id        Int      @id @default(autoincrement())
  habitId   Int
  userId    Int
  date      DateTime @db.Date
  completed Boolean  @default(false)
  createdAt DateTime @default(now()) // Pour tracking des rattrapages

  // Relations
  habit     Habit @relation(fields: [habitId], references: [id], onDelete: Cascade)
  user      User  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([habitId, date])
  @@index([userId, date])
  @@index([habitId, date, completed]) // Pour calcul streaks
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ® PROGRESSION & GAMIFICATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model UserProgress {
  id             Int       @id @default(autoincrement())
  userId         Int       @unique
  totalXp        Int       @default(0)
  currentLevel   Int       @default(1)
  bestStreak     Int       @default(0) // Meilleur streak global tous habitudes confondues
  lastLoginDate  DateTime? // Pour popup rattrapage (US6)
  lastActivity   DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸŒ³ DÃ‰CORATIONS & ENVIRONNEMENT (Phase 2)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model DecorationItem {
  id          Int      @id @default(autoincrement())
  name        String
  category    String   // tree, flower, rock, crystal, etc.
  unlockLevel Int      // Niveau requis pour dÃ©bloquer
  imagePath   String   // Chemin vers l'asset
  rarity      Rarity   @default(COMMON)
  createdAt   DateTime @default(now())

  // Relations
  userDecorations UserDecoration[]
  habits          Habit[] // US12: habitudes liÃ©es Ã  cet Ã©lÃ©ment

  @@index([unlockLevel])
  @@index([category, unlockLevel])
}

model UserDecoration {
  id            Int      @id @default(autoincrement())
  userId        Int
  decorationId  Int
  positionX     Float?   // Position dans l'environnement
  positionY     Float?
  scale         Float    @default(1.0)
  growthLevel   Int      @default(1) // US12: croissance selon habitudes
  acquiredAt    DateTime @default(now())

  // Relations
  user       User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  decoration DecorationItem @relation(fields: [decorationId], references: [id], onDelete: Cascade)

  @@unique([userId, decorationId, positionX, positionY])
  @@index([userId])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â±ï¸ SESSIONS DE FOCUS (Phase 3)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model FocusSession {
  id          Int       @id @default(autoincrement())
  userId      Int
  habitId     Int?      // Association optionnelle Ã  une habitude
  duration    Int       // En minutes (15, 25, 45)
  xpEarned    Int       // XP gagnÃ© pour cette session
  completed   Boolean   @default(false)
  interrupted Boolean   @default(false) // PÃ©nalitÃ© si interrompu
  startedAt   DateTime  @default(now())
  completedAt DateTime?

  // Relations
  user  User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  habit Habit? @relation(fields: [habitId], references: [id], onDelete: SetNull)

  @@index([userId, completedAt])
  @@index([userId, completed])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ† BADGES & ACHIEVEMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model Badge {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String
  iconPath    String
  category    String   // streak, focus, social, milestone
  requirement String   // Description du critÃ¨re (ex: "100 completions")
  createdAt   DateTime @default(now())

  // Relations
  userBadges UserBadge[]

  @@index([category])
}

model UserBadge {
  id         Int      @id @default(autoincrement())
  userId     Int
  badgeId    Int
  unlockedAt DateTime @default(now())

  // Relations
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  badge Badge @relation(fields: [badgeId], references: [id], onDelete: Cascade)

  @@unique([userId, badgeId])
  @@index([userId, unlockedAt])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“‹ ENUMS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

enum HabitType {
  GOOD
  BAD
}

enum Frequency {
  DAILY
  WEEKLY
}

enum Rarity {
  COMMON
  RARE
  EPIC
  LEGENDARY
}
